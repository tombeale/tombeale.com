<!--<?require "../../config/globals.php";require "../../inc/utility_functions.php";require "../../inc/dbfunctions.php";require "../../inc/datefunctions.php";require "../../inc/watchdog.php";$dt    = $_REQUEST["dt"];$cdate = $_REQUEST["cdate"];$rec   = $_REQUEST["rec"];$key   = $_REQUEST["key"];$hasPerm = getPerm("0,9,18");if ($hasPerm > 1)	{	$action = "INSERT";	$removeCap = "Remove";	$sql = "SELECT DISTINCT category FROM Events ORDER BY category";	$cats = doQuery($db,$sql);	if ($id != "")		{		connect();		$sql = "SELECT * FROM Events WHERE id = $id";		$R =  SQL($sql);		$r = mysql_fetch_array($R);		$action = "UPDATE";				if ($r["recurring"] == "1") $removeCap = "Remove Series";		}	}function val($s)	{	global $r;	global $id;		if ($id == "") return "";	return $r[$s];	}function field($name,$size,$max)	{	global $r;	global $id;	$buffer = "";	$value = "";	if ($id != "") $value = $r[$name];		$buffer .= '<input class="input2" name="' . $name . '" value="' . $value . '" size="' . $size . '" maxlength="' . $max .'">';	echo $buffer;	}function datefield($name)	{	global $r;	global $id;	$buffer = "";	$value = "";	if ($id != "") $value = $r[$name];		$buffer .= '<input class="input2" name="' . $name . '" value="' . $value . '" size="10" maxlength="10">';	$buffer .= "&nbsp;<a href=\"JavaScript:goCal('$name')\"><img src='../../img/calendar.gif' border='0'></a>";	echo $buffer;	}function datefieldv($name, $value)	{	global $r;	global $id;	$buffer = "";		$buffer .= '<input class="input2" name="' . $name . '" value="' . $value . '" onchange="calchange(this)" size="10" maxlength="10">';	$buffer .= "&nbsp;<a href=\"JavaScript:goCal('$name')\"><img src='../../img/calendar.gif' border='0'></a>";	echo $buffer;	}function text($name,$w,$h)	{	global $r;	global $id;	$buffer = "";	$value = "";	if ($id != "") $value = $r[$name];		$buffer .= "<textarea class='input2' name='$name' style='height:$h;width:$w;'>$value</textarea>";	echo $buffer;	}?>--><html><head>    <title>    	Edit Event    </title><script language="JavaScript" src="../../lib/innerhtml.js"></script><script language="JavaScript">// startDate, endDate, title, subtitle, url, linktype, description, // recurring, repeattype, repeatday, recurringid, winparams, id, category	var rec = new Array()	var cDate = "<?echo $cdate?>";	var startDateSave;		rec["linktype"] = "<?echo val("linktype")?>"	rec["recurring"] = "<?echo val("recurring")?>"	rec["repeattype"] = "<?echo val("repeattype")?>"	rec["repeatday"] = "<?echo val("repeatday")?>"	rec["recurringid"] = "<?echo val("recurringid")?>"	function goCal(name)		{		window.open("../popups/calendar.php?name=" + name,"cal","width=180,height=150");		}	function setparams(obj)		{		if ((obj.value == "2") || (obj.value == "4")) Q('<?field("winparams",24,80)?>');		QPrint("windowparamsec");		}		function toggleRecurring()		{		if (rec["recurring"] != "1") rec["recurring"] = "1";		else rec["recurring"] = "0";		refreshrepeat()		}	function getOptions(sOpts,sDef)		{		var arrOpts = sOpts.split(",");		var arrOpt		var sSel		var sBuffer = ""				for (var a=0;a<arrOpts.length;a++)			{			sSel = "";			arrOpt = arrOpts[a].split(":");			if (arrOpt[0] == sDef) sSel = " selected";			sBuffer += "<option value='" + arrOpt[0] + "'" + sSel + ">" + arrOpt[1] + "</option>";			}		return sBuffer;		}	function calchange(obj)		{		alert("Name: " + obj.name);		}	function setRType(obj)		{		rec["repeattype"] = obj.value;		refreshrepeat()		}	function setRDay(obj)		{		rec["repeatday"] = obj.value;		}	function refreshrepeat()		{		var sLabel;		Q("<table class='label' border='0'>");		switch (rec["recurring"])			{			case "0":				Q("<tr>");					Q("<td class='link' onmouseup='toggleRecurring()'>");						Q("<input type='checkbox' value='1' >&nbsp;This is a recurring event.");					Q("</td>");					Q("<input type='hidden' name='recurring' value='0'>");					Q("<input type='hidden' name='repeattype' value=''>");					Q("<input type='hidden' name='repeatday' value='0'>");					Q("<input type='hidden' name='recurringid' value='0'>");				Q("</tr>");				break;							case "2":				Q("<tr>");					Q("<td>");						Q("This event overrides a recurring event.");					Q("</td>");					Q("<input type='hidden' name='recurring' value='2'>");					Q("<input type='hidden' name='repeattype' value=''>");					Q("<input type='hidden' name='repeatday' value='0'>");					Q("<input type='hidden' name='recurringid' value='<?echo val("recurringid")?>'>");				Q("</tr>");				break;							case "1":				Q("<tr>");					Q("<td class='link' onmouseup='toggleRecurring()' colspan='3'>");												if ("<?echo $rec["recurringid"]?>" != "1")							{							Q("<input type='checkbox' value='1' onclick='toggleRecurring(this)' checked>&nbsp;This is a recurring event.");							}						else 							{							Q("<input type='button' value='Release Override of Recurring Event' onclick='releaseOverride(this)'>");							}					Q("</td>");					Q("<input type='hidden' name='recurring' value='1'>");				Q("</tr>");				Q("<tr>");					Q("<td class='caption'>Type</td>");					Q("<td>");						Q("<select name='repeattype' onchange='setRType(this)'>");							Q(getOptions("W:Weekly",rec["repeattype"]));						Q("</select>");					Q("</td>");					Q("<td rowspan='2' valign='top' align='right' width='100%'>");						Q("<input type='button' class='button' onmouseup='dosubmit()' value='Apply Changes\nTo Series'>");					Q("</td>");				Q("</tr>");								switch (rec["repeattype"])					{					case "M":						sLabel = "<nobr>Day of Month</nobr>";						Q("<tr>");							Q("<td class='caption'>" + sLabel + "</td>");							Q("<td>");								Q("<input type='text' class='input2' name='repeatday' value='" + rec["repeatday"] + "' size='1' maxlength='2' onkeyup='setRDay(this)'>");							Q("</td>");						Q("</tr>");						break;					case "W":					default:						sLabel = "<nobr>Day of Week</nobr>";						Q("<tr>");							Q("<td class='caption'>" + sLabel + "</td>");							Q("<td>");								Q("<select name='repeatday'>");									Q(getOptions("0:Sunday,1:Monday,2:Tuesday,3:Wednesday,4:Thursday,5:Friday,6:Saturday",rec["repeatday"]));								Q("</select>");							Q("<td>");							Q("</tr>");						break;					}				break;			}		Q("</table>");		QPrint("repeatsec");		}	function doLoad()		{		setparams(document.details.linktype);		self.focus();		startDateSave = document.details.startDate.value;		refreshrepeat();		}	function saveOverride()		{		document.details.act.value = "INSERTOVERRIDE"		document.details.submit();		}	function remove()		{		<?		if ($r["recurring"] != "1")			{			?>				if (confirm("Remove this event?"))				{				document.details.act.value = "DELETE"				document.details.submit();				}			<?			}		else			{			?>			if (confirm("This will remove the entire series, including any overrides. Continue?"))				{				document.details.act.value = "DELETESERIES"				document.details.submit();				}			<?			}		?>		}	function dosubmit()		{		if ("<?echo val("recurring")?>" == "1")			{			if (startDateSave == document.details.startDate.value) document.details.startDate.value = "<?echo val("startDate")?>"			}		document.details.submit();		}</script><link rel="stylesheet" href="../../config/forms.css" type="text/css" media="screen"></head><body bgcolor="ffffff" background="../../img/eventbak.gif" onload="doLoad()"><form name="details" actio="http://picard/echo.asp" action="eventsave.php" method="post"><table class='label'>	<tr>		<td class='caption' valign='top'>					</td>		<td colspan='3' style='padding: 0x 0 5px 0;'>			<span class='popuptitle'>Edit Event</span><br>			<?echo val("title")?> <?echo $dt?>		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Title		</td>		<td colspan='3'>			<?field("title",30,45)?> (Bold)		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Subitle		</td>		<td colspan='3'>			<?field("subtitle",30,45)?> (Not Bold)		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Description		</td>		<td colspan='3'>			<?text("description",300,60)?>		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Start Date		</td>		<td>			<?			if ($id == "")				{				datefieldv("startDate",$dt);				}			else				{				if ($r["recurring"] == "1")					{					datefieldv("startDate",$cdate);					}				else					{					datefield("startDate");					}				}			?>		</td>		<td class='caption' valign='top'>			End Date		</td>		<td>			<?datefield("endDate")?>		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Link URL		</td>		<td colspan='3'>			<?field("url",45,100)?>		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Link Type		</td>		<td colspan='3'>			<select name="linktype" onchange="setparams(this)">				<?				$opts = split(",","0:New Window,1:Main Page,2:Popup Window,3:Play Sound File,4:Notes");				for ($a=0;$a<count($opts);$a++)					{					$sep = "";					$o2 = split(":",$opts[$a]);					if (val("linktype") == $o2[0]) $sep = " selected";					echo "<option value='" . $o2[0] . "'$sep>" . $o2[1] . "</option>";					}				?>			</select>&nbsp;<span id='windowparamsec'></span>		</td>	</tr>	<tr>		<td class='caption' valign='top'>			Repeating		</td>		<td colspan='3' id="repeatsec" class="area">					</td>	</tr>	<tr>		<td colspan='4' align='right'>			<input type='button' class='redbutton' onmouseup='remove()' value="<?echo $removeCap?>">&nbsp;&nbsp;			<?			if (($r["recurring"] == "1") && ($r["recurringid"] == "0"))				{				?>				<input type='button' class='button' onmouseup='saveOverride()' value="Override Repeating Event">				<?				}			else				{				?>				<input type='button' class='button' onmouseup='dosubmit()' value="Apply Changes">				<?				}			?>		</td>	</tr></table><input type="hidden" name="key" value="<?echo $key?>"><input type="hidden" name="act" value="<?echo $action?>"><input type="hidden" name="id" value="<?echo $id?>"></form></body></html>